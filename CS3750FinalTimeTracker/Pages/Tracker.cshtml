@page
@model CS3750FinalTimeTracker.Pages.TrackerModel
@using Microsoft.AspNetCore.Http;
@{
    ViewData["Title"] = "Home page";
}

<html>
<body>

    <head>
        <script src="~/lib/node_modules/chart.js/dist/Chart.js"></script>
        <style>
            table {
                border-radius: 7px;
            }
        </style>
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css" />
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.6.4/css/buttons.dataTables.min.css" />
    </head>
    <div class="container-fluid">
        <div class="col-9">
            <input id="inputSalt" value="@HttpContext.Session.GetString("salt")" />
        </div>
        <div class="col-9">
            <input id="inputHash" value="@HttpContext.Session.GetString("hash")" />
        </div>
        <div class="col-9">
            <input id="username" value="@HttpContext.Session.GetString("username")" />
        </div>
        <div class="col-9">
            <input id="inputGroup" value="@HttpContext.Session.GetInt32("groupId")" />
        </div>
        <div class="row p-3">
            <div class="col-md-6" id="timeTrackerDiv">
                <div class="row">
                    <div class="col-md-12 pl-4 pr-4 pb-4">
                        <div class="row">
                            <div class="col-md-12 p-5 shadow bg-white rounded">
                                <div class="jumbotron">
                                    <h1 id="timer" class="display-2 text-center">
                                        00:00:00
                                    </h1>
                                </div>
                                <div class="row mb-4">
                                    <div class="col-md-4">
                                        <div class="row">
                                            <div class="col-12 text-center">
                                                <h5>Start Time</h5>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12 text-center">
                                                <span id="startTimeLabel" class="badge badge-default text-center">00:00</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="row">
                                            <div class="col-12 text-center">
                                                <h5>Current Time</h5>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12 text-center">
                                                <span id="currentTimeLabel" class="badge badge-default text-center">00:00</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="row">
                                            <div class="col-12 text-center">
                                                <h5>End Time</h5>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12 text-center">
                                                <span id="endTimeLabel" class="badge badge-default text-center">00:00</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button id="trackerStartStopBtn" type="button" class="btn btn-lg btn-success btn-block">
                                    Start Tracking
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-12 pl-4 pr-4 pb-8">
                        <div class="row">
                            <div class="col-md-12 p-5 shadow bg-white rounded">
                                <canvas id="myChart" width="300" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <table class="table table-bordered table-striped rounded">
                    <thead class="text-light bg-dark">
                        <tr>
                            <th class="">
                                User Name
                            </th>
                            <th>
                                Start Time
                            </th>
                            <th>
                                End Time
                            </th>
                            <th>
                                Description
                            </th>
                            <th>
                                Total Time
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @*@foreach (var item in Model.UserList.Where(c => c.GroupId == groupId)*@
                        @* @if(item.startTime != Null {} *@
                        @foreach (var item in Model.UserList)
                        {
                            @if (item.startTime != null && item.GroupId == HttpContext.Session.GetInt32("groupId"))
                            {
                                <tr>
                                    <td>@item.userName</td>
                                    <td>@item.startTime</td>
                                    <td>@item.endTime</td>
                                    <td>@item.description</td>
                                    <td>@item.totalTime</td>

                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div method="post" class="modal fade" id="recordTimeModal" tabindex="-1" role="dialog" aria-labelledby="recordTimeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Record New Time</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form method="post">
                        <div class="form-group">
                            <label for="descriptionTextView" class="col-form-label">Start Time:</label>
                            <input asp-for="UserObj.startTime" type="text" class="form-control" id="startTimeValueLabel">
                        </div>
                        <div class="form-group">
                            <label for="descriptionTextView" class="col-form-label">End Time:</label>
                            <input asp-for="UserObj.endTime" type="text" class="form-control" id="endTimeValueLabel">
                        </div>
                        <div class="form-group">
                            <label for="timeValueLabel" class="col-form-label">Total Time (seconds):</label>
                            <input asp-for="UserObj.totalTime" type="text" class="form-control" id="timeValueLabel">
                        </div>
                        <div class="form-group">
                            <label for="descriptionTextView" class="col-form-label">Description:</label>
                            <textarea asp-for="UserObj.description" class="form-control" id="descriptionTextView"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <button id="modalSave" type="submit" class="btn btn-success">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

@section Scripts{
    <script src="~/js/user.js"></script>
    <script src="~/js/tracker.js"></script>

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
}

<script>
    var ctx = document.getElementById('myChart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
            datasets: [{
                label: '# of Votes',
                data: [12, 19, 3, 5, 2, 3],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        }
    });

    $(document).ready(function () {
        document.getElementById("trackerDiv").disabled = false;
        document.getElementById("trackerStartStopBtn").disabled = false;
    });

</script>

